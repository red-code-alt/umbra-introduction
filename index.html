<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Umbra: I Sette Regni - I Doni di Umbra</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=Inter:wght@300;400;500;600&display=swap');

        :root {
            --primary-gold: #d4a574;
            --secondary-gold: #f4e5d3;
            --dark-blue: #1a1a2e;
            --medium-blue: #16213e;
            --light-cream: #e8d5b5;
            --muted-cream: #c9b79c;
            --gradient-1: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f1419 100%);
            --gradient-2: linear-gradient(45deg, #d4a574 0%, #b8956e 100%);
            --shadow-gold: rgba(212, 165, 116, 0.2);
            --shadow-dark: rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Crimson Text', serif;
            background: var(--gradient-1);
            color: var(--light-cream);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 20%, rgba(212, 165, 116, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 80%, rgba(212, 165, 116, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        .header {
            text-align: center;
            padding: 4rem 2rem;
            background: linear-gradient(135deg, rgba(0,0,0,0.8) 0%, rgba(26,26,46,0.9) 100%);
            border-bottom: 1px solid var(--primary-gold);
            position: relative;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .header::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(212, 165, 116, 0.1) 0%, transparent 70%);
            pointer-events: none;
        }

        h1 {
            font-family: 'Cinzel', serif;
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 700;
            background: var(--gradient-2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: none;
            margin-bottom: 1rem;
            letter-spacing: 2px;
            position: relative;
            z-index: 1;
        }

        .subtitle {
            font-size: 1.2rem;
            font-weight: 300;
            color: var(--muted-cream);
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .intro-section {
            background: linear-gradient(135deg, rgba(212, 165, 116, 0.05) 0%, rgba(212, 165, 116, 0.1) 100%);
            border: 1px solid rgba(212, 165, 116, 0.3);
            border-radius: 20px;
            padding: 3rem;
            margin-bottom: 4rem;
            box-shadow: 0 10px 30px var(--shadow-dark), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .intro-section::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: var(--gradient-2);
            border-radius: 20px;
            z-index: -1;
            opacity: 0.1;
        }

        .intro-section h2 {
            font-family: 'Cinzel', serif;
            font-size: 2rem;
            color: var(--primary-gold);
            margin-bottom: 1.5rem;
            text-align: center;
            position: relative;
        }

        .intro-section h2::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 2px;
            background: var(--gradient-2);
        }

        .intro-section p {
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 1.5rem;
            text-align: justify;
            font-family: 'Crimson Text', serif;
        }

        .map-container {
            background: linear-gradient(135deg, rgba(0,0,0,0.4) 0%, rgba(26,26,46,0.3) 100%);
            border: 1px solid rgba(212, 165, 116, 0.3);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 3rem;
            text-align: center;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .map-placeholder {
            color: var(--muted-cream);
            font-style: italic;
            font-size: 1.1rem;
            opacity: 0.7;
        }

        .map-container img {
            max-width: 100%;
            height: auto;
            border-radius: 15px;
        }

        .kingdoms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 2.5rem;
            margin-bottom: 4rem;
        }

        .kingdom-card {
            background: linear-gradient(135deg, rgba(0,0,0,0.6) 0%, rgba(26,26,46,0.4) 100%);
            border: 1px solid rgba(212, 165, 116, 0.3);
            border-radius: 20px;
            padding: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            opacity: 1;
        }

        .kingdom-card.fade-in {
            animation: fadeInUp 0.6s ease forwards;
            opacity: 0;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .kingdom-card.fade-in:nth-child(1) { animation-delay: 0.1s; }
        .kingdom-card.fade-in:nth-child(2) { animation-delay: 0.2s; }
        .kingdom-card.fade-in:nth-child(3) { animation-delay: 0.3s; }
        .kingdom-card.fade-in:nth-child(4) { animation-delay: 0.4s; }
        .kingdom-card.fade-in:nth-child(5) { animation-delay: 0.5s; }
        .kingdom-card.fade-in:nth-child(6) { animation-delay: 0.6s; }
        .kingdom-card.fade-in:nth-child(7) { animation-delay: 0.7s; }

        .kingdom-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.4), 0 0 0 1px var(--primary-gold);
            border-color: var(--primary-gold);
        }

        .kingdom-card h3 {
            font-family: 'Cinzel', serif;
            background: var(--gradient-2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.75rem;
            font-size: 1.6rem;
            font-weight: 600;
            position: relative;
            z-index: 2;
        }

        .kingdom-subtitle {
            color: var(--muted-cream);
            font-style: italic;
            margin-bottom: 1.5rem;
            font-size: 1rem;
            opacity: 0.9;
            position: relative;
            z-index: 2;
        }

        .kingdom-preview {
            font-size: 1rem;
            line-height: 1.7;
            margin-bottom: 1rem;
            font-family: 'Crimson Text', serif;
            position: relative;
            z-index: 2;
        }

        .kingdom-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
            margin-top: 1rem;
        }

        .kingdom-details.active {
            max-height: 1500px;
        }

        .details-tabs {
            display: flex;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid rgba(212, 165, 116, 0.3);
        }

        .tab-button {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            color: var(--muted-cream);
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .tab-button.active {
            color: var(--primary-gold);
            border-bottom-color: var(--primary-gold);
            opacity: 1;
        }

        .tab-button:hover {
            opacity: 1;
            color: var(--secondary-gold);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .chronicles-content {
            background: linear-gradient(135deg, rgba(139, 119, 91, 0.1) 0%, rgba(101, 88, 71, 0.05) 100%);
            border: 1px solid rgba(139, 119, 91, 0.3);
            border-radius: 15px;
            padding: 2rem;
            margin: 1rem 0;
            position: relative;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .chronicles-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="parchment" patternUnits="userSpaceOnUse" width="20" height="20"><rect width="20" height="20" fill="%23f4f1e8" opacity="0.05"/><circle cx="3" cy="7" r="0.5" fill="%23d4a574" opacity="0.1"/><circle cx="17" cy="13" r="0.3" fill="%23d4a574" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23parchment)"/></svg>');
            border-radius: 15px;
            opacity: 0.3;
            pointer-events: none;
        }

        .chronicles-content h4 {
            color: var(--primary-gold);
            font-family: 'Cinzel', serif;
            margin-bottom: 1rem;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .chronicles-content h4::before {
            content: 'üìú';
            font-size: 1rem;
        }

        .chronicles-text {
            font-family: 'Crimson Text', serif;
            line-height: 1.8;
            font-size: 1rem;
            color: var(--light-cream);
            text-align: justify;
            position: relative;
            z-index: 1;
        }

        .chronicles-text p {
            margin-bottom: 1rem;
        }

        .chronicles-text p:last-child {
            margin-bottom: 0;
        }

        .artwork-content {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.3) 0%, rgba(26, 26, 46, 0.2) 100%);
            border: 1px solid rgba(212, 165, 116, 0.2);
            border-radius: 15px;
            padding: 1rem;
            margin: 1rem 0;
            text-align: center;
            position: relative;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .artwork-content img {
            max-width: 60%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .artwork-content img:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.6);
        }

        .artwork-content img.zoomed {
            max-width: 95%;
            transform: scale(1);
            cursor: zoom-out;
        }

        .artwork-content img.zoomed:hover {
            transform: scale(1);
        }

        .artwork-placeholder {
            color: var(--muted-cream);
            font-style: italic;
            padding: 3rem 2rem;
            opacity: 0.6;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        .artwork-placeholder::before {
            content: 'üé®';
            font-size: 3rem;
            opacity: 0.5;
        }

        .artwork-content h4 {
            color: var(--primary-gold);
            font-family: 'Cinzel', serif;
            margin-bottom: 1rem;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .artwork-content h4::before {
            content: 'üé®';
            font-size: 1rem;
        }

        .kingdom-card.chronicle-expanded {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            bottom: 20px;
            z-index: 1000;
            max-width: none;
            width: auto;
            height: auto;
            overflow-y: auto;
            animation: expandToFullscreen 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 0 25px 50px rgba(0,0,0,0.8);
        }

        @keyframes expandToFullscreen {
            from {
                transform: scale(1);
            }
            to {
                transform: scale(1);
            }
        }

        .kingdom-card.chronicle-expanded .kingdom-details {
            max-height: none !important;
        }

        .kingdom-card.chronicle-expanded .chronicles-content {
            max-height: calc(100vh - 300px);
            overflow-y: auto;
            margin: 2rem 0;
        }

        .kingdom-card.chronicle-expanded .expand-indicator {
            display: none;
        }

        .chronicle-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(26, 26, 46, 0.85) 0%, 
                rgba(22, 33, 62, 0.90) 50%, 
                rgba(15, 20, 25, 0.85) 100%);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 999;
            opacity: 0;
            animation: fadeInOverlay 0.3s ease forwards;
        }

        @keyframes fadeInOverlay {
            to {
                opacity: 1;
            }
        }

        .chronicle-close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--primary-gold);
            color: var(--dark-blue);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s ease;
            z-index: 1001;
            display: none;
        }

        .kingdom-card.chronicle-expanded .chronicle-close-btn {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chronicle-close-btn:hover {
            background: var(--secondary-gold);
            transform: scale(1.1);
        }

        body.chronicle-open {
            overflow: hidden;
        }

        .kingdom-details h4 {
            color: #d4a574;
            margin: 1rem 0 0.5rem 0;
            font-size: 1.1rem;
        }

        .kingdom-details ul {
            list-style: none;
            padding-left: 1rem;
        }

        .kingdom-details li {
            margin-bottom: 0.5rem;
            position: relative;
            padding-left: 1.5rem;
        }

        .kingdom-details li:before {
            content: "‚óÜ";
            position: absolute;
            left: 0;
            color: #d4a574;
        }

        .expand-indicator {
            text-align: center;
            color: #d4a574;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            transition: opacity 0.3s ease;
        }

        .kingdom-card:hover .expand-indicator {
            opacity: 0.8;
        }

        .gift-box {
            background: linear-gradient(135deg, rgba(212, 165, 116, 0.15) 0%, rgba(212, 165, 116, 0.05) 100%);
            border: 1px solid rgba(212, 165, 116, 0.4);
            border-left: 4px solid var(--primary-gold);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            position: relative;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .gift-box::before {
            content: '‚ú¶';
            position: absolute;
            top: -8px;
            left: 15px;
            background: var(--gradient-1);
            color: var(--primary-gold);
            padding: 0 8px;
            font-size: 14px;
        }

        .footer {
            text-align: center;
            padding: 3rem 2rem;
            background: linear-gradient(135deg, rgba(0,0,0,0.8) 0%, rgba(26,26,46,0.9) 100%);
            border-top: 1px solid rgba(212, 165, 116, 0.3);
            margin-top: 4rem;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .footer p {
            color: var(--muted-cream);
            font-style: italic;
            font-size: 1.1rem;
            opacity: 0.8;
        }

        .scroll-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--primary-gold);
            color: var(--dark-blue);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s ease, transform 0.3s ease;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            font-size: 1.3rem;
            font-weight: bold;
        }

        .scroll-to-top.visible {
            opacity: 0.9;
        }

        .scroll-to-top:hover {
            transform: scale(1.1);
            opacity: 1;
        }

        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--primary-gold);
            border-radius: 50%;
            opacity: 0;
            animation: float 15s infinite linear;
            box-shadow: 0 0 6px var(--primary-gold);
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) translateX(0px);
                opacity: 0;
            }
            10% {
                opacity: 0.6;
            }
            90% {
                opacity: 0.6;
            }
            100% {
                transform: translateY(-100px) translateX(50px);
                opacity: 0;
            }
        }

        .section-title {
            font-family: 'Cinzel', serif;
            text-align: center;
            color: var(--primary-gold);
            margin-bottom: 3rem;
            font-size: 2.5rem;
            position: relative;
        }

        .section-title::before,
        .section-title::after {
            content: '‚óÜ';
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-gold);
            opacity: 0.5;
        }

        .section-title::before {
            left: -50px;
        }

        .section-title::after {
            right: -50px;
        }

        /* Forza tema scuro e previeni interferenze del browser */
        body {
            color-scheme: dark only;
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Media query per mobile */
        @media (max-width: 768px) {
            body {
                background: var(--gradient-1) !important;
                color: var(--light-cream) !important;
            }
            
            .header {
                padding: 3rem 1rem;
                background: linear-gradient(135deg, rgba(0,0,0,0.8) 0%, rgba(26,26,46,0.9) 100%) !important;
            }
            
            h1 {
                font-size: 2.5rem;
                background: var(--gradient-2) !important;
                -webkit-background-clip: text !important;
                -webkit-text-fill-color: transparent !important;
                background-clip: text !important;
            }
            
            .kingdoms-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
            }

            .intro-section {
                padding: 2rem;
                background: rgba(26, 26, 46, 0.8) !important;
                color: var(--light-cream) !important;
            }

            .kingdom-card {
                background: linear-gradient(135deg, rgba(26, 26, 46, 0.9) 0%, rgba(22, 33, 62, 0.8) 100%) !important;
                color: var(--light-cream) !important;
            }

            .section-title::before,
            .section-title::after {
                display: none;
            }

            .scroll-to-top {
                bottom: 20px;
                right: 20px;
                width: 50px;
                height: 50px;
            }

            /* Modal fullscreen su mobile */
            .kingdom-card.chronicle-expanded {
                top: 10px;
                left: 10px;
                right: 10px;
                bottom: 10px;
            }

            .chronicles-content {
                padding: 1.5rem !important;
            }

            .tab-button {
                padding: 0.5rem 1rem;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="floating-particles" id="particles"></div>
    
    <header class="header">
        <h1>Umbra: I Sette Regni</h1>
        <p class="subtitle">I Doni di Umbra</p>
    </header>

    <div class="container">
        <section class="intro-section">
            <h2>Benvenuti nel Mondo dei Doni</h2>
            <p>
                In un'era perduta nella nebbia del tempo, gli Spiriti - entit√† di potere inimmaginabile - guardarono 
                il mondo mortale con interesse. Videro potenziale e fragilit√†, ambizione e limite. E cos√¨, in un 
                gesto che alcuni chiamano generosit√† e altri maledizione, donarono a sette regni altrettanti Doni 
                di potere straordinario.
            </p>
            <p>
                Ogni Dono ha plasmato il regno che lo ha ricevuto, trasformando non solo la terra e la pietra, ma 
                l'essenza stessa di chi vi abita. Questi non sono semplici artefatti magici - sono forze che hanno 
                riscritto le leggi della realt√† stessa, creando meraviglie e orrori in egual misura.
            </p>
            <p>
                Viaggiatore, mentre esplori questi regni, ricorda: ogni potere ha un prezzo, ogni dono nasconde un 
                peso. E in questo mondo dove la morte pu√≤ essere temporanea, dove il tempo scorre diversamente, dove 
                la verit√† stessa pu√≤ essere vincolante... l'unica certezza √® che nulla √® come sembra.
            </p>
        </section>

        <section class="map-container">
            <div class="map-placeholder" id="mapContainer">
                [La Mappa dei Sette Regni apparir√† qui]
            </div>
        </section>

        <section class="kingdoms-section">
            <h2 class="section-title">I Regni e i Loro Doni</h2>
            
            <div class="kingdoms-grid" id="kingdomsGrid">
                <!-- I regni verranno inseriti via JavaScript -->
            </div>
        </section>
    </div>

    <footer class="footer">
        <p>Che gli Spiriti guidino il vostro cammino... o almeno non lo ostacolino.</p>
    </footer>

    <div class="scroll-to-top" id="scrollToTop">‚Üë</div>

    <script>
        // Funzione per rimuovere spoiler dal testo
        function removeSpoilers(text) {
            if (!text) return '';
            
            // Rimuove spoiler in formato ||spoiler||
            text = text.replace(/\|\|([^|]*)\|\|/g, '');
            
            // Rimuove spoiler in formato [spoiler]text[/spoiler]
            text = text.replace(/\[spoiler\](.*?)\[\/spoiler\]/gi, '');
            
            // Rimuove spoiler in formato >!spoiler!<
            text = text.replace(/>!(.*?)!</g, '');
            
            // Pulisce spazi multipli e newline extra
            text = text.replace(/\s+/g, ' ').trim();
            
            return text;
        }

        // Funzione per convertire testo in paragrafi HTML
        function formatChronicleText(text) {
            if (!text) return '';
            
            const cleanText = removeSpoilers(text);
            const paragraphs = cleanText.split('\n\n').filter(p => p.trim());
            
            return paragraphs.map(p => `<p>${p.trim()}</p>`).join('');
        }

        const kingdoms = [
            {
                name: "Malegrim",
                subtitle: "La Fortezza dei Risvegli Eterni",
                preview: "Nelle lande ghiacciate del nord, la morte √® solo una pausa temporanea...",
                gift: "Lo Stendardo del Freddo Preservante",
                giftDesc: "Permette di risvegliare i caduti in battaglia, preservandoli nel ghiaccio eterno.",
                chronicle: "Malegrim sorge come una sentinella di ghiaccio nelle terre del nord, dove l'inverno non √® una stagione ma uno stato dell'essere. La citt√† sfida ogni logica architettonica: torri di ghiaccio che non si sciolgono nemmeno d'estate, mura dentro cui si intravedono i volti dei difensori caduti, preservati nel gelo eterno.\n\nAl centro svetta la Guglia dello Stendardo, avvolta in una nebbia perpetua che pulsa di luce azzurra. √à qui che riposa il dono degli spiriti - lo Stendardo del Freddo Preservante - la cui energia permea ogni pietra, ogni respiro, ogni vita e non-vita della citt√†.\n\nLe strade sono pattugliate da soldati di ogni epoca: alcuni morti ieri, altri caduti secoli fa. Li riconosci dal grado di trasparenza della loro pelle e dal numero di cicatrici di ghiaccio che portano. I veterani pi√π antichi sono quasi spettrali, muovendosi con precisione meccanica, avendo scambiato i ricordi per l'immortalit√† guerriera.\n\nNei mausolei-caserma, migliaia dormono il sonno del ghiaccio, aspettando il loro turno. Le famiglie visitano i loro \"dormienti\", parlando loro del mondo che continua a girare. √à comune vedere bambini che raccontano ai nonni congelati delle loro giornate, nella speranza che quando verranno risvegliati, qualcosa rimanga.\n\nL'aria stessa morde, ma gli abitanti la respirano come fosse normale. \"Il caldo ammorbidisce,\" dicono, \"il freddo preserva.\" E cos√¨ vivono, in una citt√† dove la morte √® solo una pausa, dove i generali pianificano battaglie con strateghi morti da secoli, dove il prezzo della vittoria si paga in anni di vita e ricordi perduti.",
                artwork: "malegrim.jpeg",
                details: {
                    capitale: "Malegrim Alta",
                    governo: "Consiglio dei Sei Inverni (veterani multi-risveglio)",
                    popolazione: "Vivi e risvegliati in proporzioni variabili",
                    cultura: [
                        "La morte in battaglia √® vista come servizio temporaneo",
                        "I veterani di pi√π risvegli sono rispettati ma temuti",
                        "Ogni risveglio costa memorie - alcuni diventano 'Vuoti'",
                        "Architettura di ghiaccio e pietra che non si scioglie mai"
                    ],
                    economia: [
                        "Mercenari immortali molto richiesti",
                        "Esportazione di tecniche di conservazione",
                        "Turismo bellico per studiare tattiche antiche"
                    ],
                    pericoli: [
                        "Il freddo estremo √® letale per i non nativi",
                        "I 'Vuoti' vagano senza memoria n√© scopo",
                        "Politiche complesse tra vivi e risvegliati"
                    ]
                }
            },
            {
                name: "Sulbern",
                subtitle: "La Citt√† dove i Patti sono Sacri",
                preview: "Dove il fiume incontra il mare, ogni promessa ha il peso dell'oceano...",
                gift: "La Campana delle Maree Veritiere",
                giftDesc: "Rende impossibile rompere un accordo fatto mentre risuona. L'acqua punisce i traditori.",
                chronicle: "Sulbern si erge dove il Grande Fiume incontra il mare, in un abbraccio di acque che ha plasmato il destino del mondo intero. Non √® conquista militare n√© supremazia economica che l'ha resa la capitale non dichiarata dei regni, ma la semplice, terribile verit√†: qui, mentire pu√≤ ucciderti.\n\nLa citt√† si sviluppa in cerchi concentrici di canali che sfidano la natura, con l'acqua che sale dal fiume verso il mare in spirali impossibili. Al centro, la Torre della Campana emerge e sprofonda con le maree, il suo bronzo verde-azzurro che risuona quattro volte al giorno, scandendo il tempo dei patti e delle promesse.\n\nCamminando per le vie di marmo bianco e corallo vivente, il visitatore nota subito l'acqua ovunque: trasuda dalle pietre, gocciola da fontane che sussurrano antichi giuramenti, scorre in rigagnoli che sembrano seguire chi ha debiti da pagare. I diplomatici di cento regni attraversano i Ponti del Giuramento con passi misurati, sapendo che ogni parola detta sopra l'acqua corrente diventa vincolante.\n\nNei quartieri delle ambasciate, palazzi galleggianti di ogni stile architettonico dondolano dolcemente, ancorati ma mai fissi, come le alleanze che rappresentano. Sotto la superficie, stanze di vetro e magia permettono incontri che il mondo superiore non deve vedere.\n\nIl commercio fiorisce nei mercati anfibi, dove merci del mondo intero cambiano mano in transazioni che nessuno osa violare. La Banca delle Maree custodisce fortune indicibili nelle sue volte sommerse, mentre l'Universit√† del Flusso forma la prossima generazione di mediatori, insegnando loro a navigare correnti politiche pi√π pericolose di qualsiasi marea.\n\nMa √® al crepuscolo, quando la Campana tace tra una marea e l'altra, che Sulbern mostra il suo volto pi√π vero: una citt√† sospesa tra elementi, dove la verit√† √® legge fisica e la menzogna morte certa, dove ogni promessa ha il peso dell'oceano.",
                artwork: "sulbern.jpeg",
                details: {
                    capitale: "Sulbern (unica grande citt√†)",
                    governo: "Consiglio delle Acque e Assemblea delle Ambasciate",
                    popolazione: "La pi√π cosmopolita - diplomatici di ogni regno",
                    cultura: [
                        "Centro diplomatico mondiale - tutti i trattati importanti firmati qui",
                        "L'acqua √® sacra - sputarci √® crimine capitale",
                        "Architettura di canali a spirale che sfidano la gravit√†",
                        "Neutralit√† forzata - l'acqua rifiuta il sangue versato in malafede"
                    ],
                    economia: [
                        "Banking internazionale - la Banca delle Maree",
                        "Certificazione di trattati e contratti",
                        "Porto franco per ogni tipo di merce"
                    ],
                    pericoli: [
                        "Gli 'Affogati Asciutti' - chi ha tradito patti importanti",
                        "Politica complessa e letale",
                        "Dipendenza dall'acqua locale per affari"
                    ]
                }
            },
            {
                name: "Eldrith",
                subtitle: "L'Isola delle Mille Forme",
                preview: "Dove un albero argentato offre frutti che cambiano l'essenza stessa...",
                gift: "L'Albero delle Mille Forme",
                giftDesc: "Produce frutti che permettono evoluzioni permanenti di corpo e mente.",
                chronicle: "Eldrith sorge oltre il Mare Mutageno, un'isola benedetta e maledetta dall'Albero delle Mille Forme. Questa antica quercia argentata domina il cuore della citt√†, i suoi rami si estendono come braccia protettrici sopra i Giardini Sacri, mentre frutti cristallini pulsano di luce tra foglie che mutano colore con il passare delle ore.\n\nLa citt√† si sviluppa in cerchi concentrici attorno all'Albero, con architettura che fonde organico e costruito - edifici che sembrano cresciuti quanto edificati, con legno vivente intrecciato a pietra levigata. Ponti di radici argentate collegano le diverse altezze della citt√†, mentre giardini pensili ospitano propaggini dell'Albero che fioriscono in sincronia con la pianta madre.\n\nI cittadini di Eldrith portano con grazia le loro Marche. Un'elfa attraversa il mercato con ali di farfalla cristallina che catturano la luce, mentre un nano con quattro braccia perfettamente coordinate forgia meraviglie nella sua bottega. Sotto la pelle di ognuno, una piccola gemma luminosa pulsa dove il frutto dell'Albero fu innestato, testimonianza della loro trasformazione.\n\nLa vita segue i ritmi dell'Albero. Durante la Stagione del Cielo, maturano i frutti azzurri che donano il volo; in Autunno Profondo, i frutti rosso sangue della Marca del Predatore pendono pesanti dai rami. I Custodi dell'Albero, druidi urbani in vesti tessute di foglie argentate, leggono i segni nella corteccia e predicono quali doni saranno disponibili.\n\nIl Mare Mutageno circonda ancora l'isola con le sue acque cangianti, ma ora si dice che sia l'Albero stesso a controllarlo - permettendo solo a chi √® in armonia con la sua natura di raggiungere Eldrith. Le navi dei \"disarmonici\" vengono gentilmente ma fermamente respinte da correnti impossibili, mentre chi √® destinato alla trasformazione trova sempre venti favorevoli.",
                artwork: "eldrith.jpeg",
                details: {
                    capitale: "Eldrith Alta",
                    governo: "Concilio delle Stagioni e i Dodici Guardiani",
                    popolazione: "70% evoluti, 20% 'Puri', 10% forme uniche",
                    cultura: [
                        "12 'Marche' standard di evoluzione disponibili",
                        "I 'Puri' non evoluti sono cittadini di seconda classe",
                        "L'Albero decide quali frutti produrre ogni stagione",
                        "Architettura organica che si adatta alle forme dei cittadini"
                    ],
                    economia: [
                        "Lavoratori specializzati ultra-evoluti",
                        "Guide per attraversare il Mare Mutageno",
                        "Frutti minori dell'Albero (molto costosi)"
                    ],
                    pericoli: [
                        "Il Mare Mutageno pu√≤ essere letale per chi non √® protetto",
                        "Germogli Appassiti - evoluzioni fallite",
                        "Discriminazione verso i 'Puri'",
                        "Alcune evoluzioni sono irreversibili"
                    ]
                }
            },
            {
                name: "Nabia",
                subtitle: "L'Oasi dove la Magia √® Scienza",
                preview: "Nel cuore del deserto, ogni incantesimo rivela le sue formule segrete...",
                gift: "Il Prisma dell'Analisi Perfetta",
                giftDesc: "Rende visibili le formule di ogni magia, trasformando l'arcano in scienza.",
                chronicle: "Nabia sorge nell'abbraccio rovente del deserto, un'oasi di vetro e metallo dove la magia non √® pi√π mistero ma matematica. Al centro della citt√†, il Prisma dell'Analisi Perfetta ruota lentamente nella sua torre, un cristallo impossibile che rifrange non solo la luce ma la realt√† stessa, rendendo visibile l'invisibile.\n\nQui, quando un mago lancia un incantesimo, l'aria si riempie di formule luminose - equazioni che danzano in caratteri dorati, diagrammi che si intrecciano come ragnatele di pura logica. Un fulmine magico non √® pi√π solo energia grezza, ma una cascata di calcoli termodinamici visibili a tutti. Una guarigione rivela la sua biochimica arcana in spirali di simboli verdi.\n\nLe strade di Nabia sono un caos ordinato di innovazione. Giovani studenti con lavagne portatili copiano freneticamente le formule che vedono fluttuare sopra i maghi di passaggio. Negozi vendono \"catturatori di formula\" - dispositivi meccanici che fotografano e riproducono schemi magici. I vecchi maghi, un tempo gelosi custodi di segreti arcani, ora si trovano a dover brevettare i loro incantesimi prima che qualcuno li \"rubi\" semplicemente guardando.\n\nL'architettura riflette questa ossessione per l'analisi: edifici con pareti di lavagna dove si scrivono teoremi, cupole di vetro per osservatori magici dove si studiano incantesimi come stelle, biblioteche-laboratorio dove la teoria incontra la pratica. Il calore del deserto alimenta fornaci dove si fondono componenti per replicatori arcani, mentre acquedotti meccanici - non magici, per principio - mantengono verde l'oasi.\n\nMa √® al tramonto che Nabia mostra il suo vero volto, quando il Prisma cattura la luce morente e la citt√† si riempie di un arcobaleno di formule - ogni incantesimo del giorno che fluttua nell'aria come un'aurora boreale matematica, ricordando a tutti che qui, in questa oasi di sabbia e scienza, il miracolo √® stato ridotto a formula, e la formula elevata a miracolo.",
                artwork: "nabia.jpeg",
                details: {
                    capitale: "Nabia dell'Oasi",
                    governo: "Consiglio dei Teoremi (matematici arcani)",
                    popolazione: "Studiosi, inventori, e pirati della conoscenza",
                    cultura: [
                        "La magia √® studiata come scienza esatta",
                        "Brevetti su formule magiche - propriet√† intellettuale arcana",
                        "Universit√† Prismatica - migliore educazione magica al mondo",
                        "Dispositivi meccanico-magici venduti ovunque"
                    ],
                    economia: [
                        "Esportazione di dispositivi arcani",
                        "Educazione magica a caro prezzo",
                        "Ricerca e sviluppo per altri regni"
                    ],
                    pericoli: [
                        "Il deserto circostante √® letale",
                        "Furti di propriet√† intellettuale magica",
                        "Alcuni impazziscono vedendo 'troppa' verit√†",
                        "Mercato nero di formule pericolose"
                    ]
                }
            },
            {
                name: "Akhozia",
                subtitle: "Il Regno dei Secoli Viventi",
                preview: "Tra le montagne eterne, la morte naturale √® quasi sconosciuta...",
                gift: "La Fonte dell'Alba Eterna",
                giftDesc: "Chi beve dalle sue acque vive per secoli, ma solo finch√© resta nel regno.",
                chronicle: "Akhozia si estende attraverso le valli e i picchi delle Montagne Eterne, un regno intero benedetto dalla longevit√†. Dai villaggi pi√π remoti alle citt√† di passo, ogni insediamento √® collegato alla rete di acquedotti che porta l'acqua della Fonte dell'Alba Eterna, garantendo a tutti i cittadini del regno la stessa straordinaria durata di vita.\n\nLa capitale, Akhozia Alta, si erge sul picco pi√π elevato, dove la Fonte sgorga eternamente nel palazzo reale. Ma √® l'intero regno a vivere secondo i ritmi dell'eternit√†: contadini che hanno coltivato lo stesso campo per sei secoli, pastori che conoscono per nome trenta generazioni di pecore, minatori che hanno scavato abbastanza a fondo da trovare metalli che altri regni credono mitologici.\n\nViaggiare per il regno significa attraversare il tempo stesso. Ogni villaggio conserva architetture di epoche diverse, tutte ancora abitate dai loro costruttori originali. Le locande sono gestite dagli stessi osti da secoli, che ricordano i bisnonni dei viaggiatori esterni che passano. I sentieri di montagna sono mantenuti dagli stessi guardiani che li hanno tracciati quando erano giovani, ormai cinquecento anni fa.\n\nLa vera meraviglia sono le relazioni umane: villaggi dove tutti sono parenti perch√© venti generazioni convivono; faide che durano da secoli ma anche amicizie millenarie; bambini che crescono conoscendo non solo la storia, ma chi quella storia l'ha vissuta. Le scuole di valle hanno insegnanti che hanno visto nascere e evolversi le materie che insegnano.\n\nAl confine del regno, le Fortezze di Avvertimento marcano il limite oltre il quale la benedizione della Fonte cessa. Le guarnigioni sono composte dai \"giovani avventurosi\" - sotto i due secoli - gli unici disposti a rischiare pattugliamenti cos√¨ vicini alla mortalit√†. Oltre quei confini, un cittadino di Akhozia inizierebbe a invecchiare rapidamente verso la sua vera et√†.\n\nNelle miniere pi√π profonde lavorano ancora i minatori che le aprirono; nelle fucine, spade iniziate tre secoli fa ricevono gli ultimi ritocchi; nelle biblioteche, gli stessi scribi copiano e ricopiano testi, migliorando la calligrafia ad ogni iterazione. √à un regno dove la perfezione non √® un obiettivo ma una conseguenza inevitabile del tempo illimitato.",
                artwork: "akhozia.jpeg",
                details: {
                    capitale: "Akhozia Alta (sui picchi pi√π alti)",
                    governo: "Consiglio Millenario - membri con 1000+ anni",
                    popolazione: "Distribuzione d'et√† estrema - convivono 20 generazioni",
                    cultura: [
                        "Pazienza infinita - decisioni prese in decenni",
                        "Maestri che perfezionano arti per secoli",
                        "Lasciare il regno significa invecchiare rapidamente",
                        "Architettura costruita e modificata per secoli dagli stessi architetti"
                    ],
                    economia: [
                        "Capolavori artigianali perfezionati per secoli",
                        "Consulenze da esperti multi-secolari",
                        "Miniere profondissime con metalli unici",
                        "Investimenti a lunghissimo termine"
                    ],
                    pericoli: [
                        "L'immortalit√† pu√≤ essere una prigione",
                        "Giustizia lentissima - processi di decenni",
                        "Sovrappopolazione lenta ma costante",
                        "Stagnazione culturale e innovativa"
                    ]
                }
            },
            {
                name: "Usha",
                subtitle: "La Citt√† dei Patti Sussurrati",
                preview: "Nelle paludi orientali, ogni accordo con l'oltre ha un prezzo...",
                gift: "Il Calderone delle Mille Voci",
                giftDesc: "Permette di stipulare patti vincolanti con entit√† extraplanari.",
                chronicle: "Usha emerge dalla palude come una visione gotica di torri storte e ponti coperti, dove la nebbia porta sussurri di potere da luoghi lontani. Qui, fare un patto con entit√† remote non √® blasfemia o follia - √® commercio regolamentato, tassato e garantito per legge.\n\nIl Calderone delle Mille Voci ribolle eternamente nella Torre del Patto Primo, custodito dalle Figlie del Calderone - una congrega che da secoli facilita i collegamenti tra mortali e forze distanti. Il suo vapore permea la citt√†, creando condizioni uniche per rituali di contatto che richiederebbero altrove preparazioni impossibili. Ogni notte, nuove voci echeggiano dal Calderone, offerte di potere che arrivano da dimensioni remote‚Ä¶ tutto ha un prezzo.\n\nLe strade di Usha sono un labirinto di possibilit√†. Al Mercato dei Contratti, giovani disperati consultano intermediari esperti per ottenere un po' di potere magico in cambio di anni di servizio. Avvocati specializzati in diritto extraplanare redigono clausole per accordi che si estendono oltre il mondo mortale. Notai certificano patti con sigilli che bruciano sia pergamena che anima.\n\nL'architettura riflette i suoi abitanti: ogni warlock che pu√≤ permetterselo ha la sua torre, storta e impossibile come i poteri che canalizza. Ponti coperti collegano le torri, permettendo rituali anche sotto la pioggia costante. Le piazze sono camere rituali permanenti dove si sigillano i contratti pi√π importanti. E ovunque, famigli - corvi con troppi occhi, gatti che camminano sulle zampe posteriori, rospi che borbottano formule - osservano e riportano ai loro padroni.\n\nLa stratificazione sociale segue linee di potere pattizio. Al vertice, i Grandi Pattisti con contratti plurisecolari con entit√† remote di grande potere. Poi i Warlock Pubblici, che hanno barattato servizio civico per capacit√† magiche - i lampioni sono mantenuti da chi ha patti con forze del fuoco, le fogne da chi serve entit√† dell'acqua. In fondo, i Senzapatto: visti come incompleti, cittadini di serie B che non hanno nulla da offrire o troppa paura per contrattare.",
                artwork: "usha.jpeg",
                details: {
                    capitale: "Usha la Velata",
                    governo: "Le Figlie del Calderone e il Consiglio dei Patti",
                    popolazione: "70% hanno almeno un patto minore attivo",
                    cultura: [
                        "Warlock e stregoneria sono professioni rispettate e regolamentate",
                        "Comunicazione con entit√† remote attraverso rituali specializzati",
                        "Sistema legale che regola contratti extraplanari",
                        "Architettura gotica con camere rituali permanenti"
                    ],
                    economia: [
                        "Mediazione di patti - avvocati specializzati",
                        "Warlock 'a noleggio' per servizi vari",
                        "Assicurazioni sui patti"
                    ],
                    pericoli: [
                        "Patti mal negoziati possono rovinare generazioni",
                        "I 'Vincolati' - chi ha perso tutto nei patti",
                        "Conflitti tra warlock al servizio di entit√† rivali",
                        "La citt√† stessa ha un patto segreto..."
                    ]
                }
            },
            {
                name: "Daston",
                subtitle: "L'Isola della Sete Divina",
                preview: "Dove gli Spiriti stessi vengono a nutrirsi, mendicanti dell'ambrosia...",
                gift: "Il Calice dell'Ambrosia Infinita",
                giftDesc: "Produce l'unica sostanza che mantiene gli Spiriti potenti nel mondo mortale.",
                chronicle: "Daston sorge su un'isola che nessun mortale avrebbe scelto - rocciosa, battuta dai venti, con poco spazio per coltivare. Eppure √® il centro spirituale del mondo, il luogo dove gli stessi spiriti vengono in pellegrinaggio. Non per devozione, ma per necessit√†. Per fame.\n\nIl Calice dell'Ambrosia Infinita riposa nel cuore del Santuario, una fortezza-tempio che non appartiene a nessuna fede specifica. Dalle sue labbra dorate sgorga l'ambrosia divina, quella sostanza dorata e luminescente che √® l'unico nutrimento che mantiene gli spiriti potenti nel regno mortale. Senza di essa, anche la pi√π potente divinit√† appassisce fino a diventare poco pi√π di un sussurro.\n\nLe strade di Daston sono teatro di scene che sfidano ogni comprensione teologica. Uno spirito della guerra fa anticamera accanto ad uno spirito dell'amore, entrambi in attesa del loro turno. Divinit√† minori della fortuna o del focolare domestico stringono tra le mani ticket numerati, sperando di essere ricevuti prima che il loro potere svanisca del tutto. Avatar divini - un tempo gloriosi - mostrano segni di stanchezza, la loro luce divina tremolante come candele al vento.\n\nNella Piazza della Sete, il mercato pi√π surreale del mondo, spiriti dimenticati barattano benedizioni minori per una singola goccia di ambrosia diluita. Ex-divinit√† di civilt√† cadute mendicano dai passanti, offrendo saggezza millenaria per poche monete con cui comprare accesso alle fontane secondarie. √à uno spettacolo che spezza il cuore e terrorizza al contempo - vedere l'immortale ridotto a mortale bisogno.\n\nI Coppieri Sacri, custodi del rituale di distribuzione, camminano con la gravit√† di chi tiene in mano il destino del cosmo. Loro decidono le porzioni: un calice pieno per il Padre dei Cieli, mezzo per il Signore dei Mari, un quarto per la Tessitrice del Destino. Ogni decisione √® politica cosmica, ogni versata pu√≤ cambiare l'equilibrio del mondo.\n\nMa √® durante l'Ora della Bevuta che Daston mostra il suo vero potere. Quando i grandi spriti bevono, la loro natura divina esplode in manifestazioni di potere puro - lampi, arcobaleni, visioni che attraversano la citt√†.",
                artwork: "daston.jpeg",
                details: {
                    capitale: "Daston la Necessaria",
                    governo: "Concilio dei Coppieri (distribuiscono l'ambrosia)",
                    popolazione: "Mortali, avatar divini, ex-spiriti mendicanti",
                    cultura: [
                        "Gli Spiriti devono venire qui per 'nutrirsi' di ambrosia",
                        "Code di entit√† divine in attesa del loro turno",
                        "Sistema di quote e razioni per ogni Spirito",
                        "Alcuni Spiriti minori mendicano gocce per strada"
                    ],
                    economia: [
                        "Commercio di ambrosia diluita",
                        "Tasse pagate in preghiere",
                        "Turismo religioso estremo",
                        "Favori divini barattati per razioni extra"
                    ],
                    pericoli: [
                        "Spiriti affamati possono essere pericolosi",
                        "Politica cosmica con conseguenze mortali",
                        "Dipendenza da ambrosia per alcuni mortali",
                        "Il Calice sta diventando... esigente"
                    ]
                }
            }
        ];

        function createKingdomCard(kingdom) {
            const card = document.createElement('div');
            card.className = 'kingdom-card';
            
            const hasChronicle = kingdom.chronicle && kingdom.chronicle.trim();
            const hasArtwork = kingdom.artwork && kingdom.artwork.trim();
            const hasExtendedContent = hasChronicle || hasArtwork;
            
            card.innerHTML = `
                <button class="chronicle-close-btn" title="Chiudi cronache">√ó</button>
                <h3>${kingdom.name}</h3>
                <p class="kingdom-subtitle">${kingdom.subtitle}</p>
                <p class="kingdom-preview">${kingdom.preview}</p>
                
                <div class="gift-box">
                    <strong>Il Dono:</strong> ${kingdom.gift}<br>
                    <em>${kingdom.giftDesc}</em>
                </div>
                
                <div class="kingdom-details" id="details-${kingdom.name}">
                    ${hasExtendedContent ? `
                    <div class="details-tabs">
                        <button class="tab-button active" data-tab="info">üìã Informazioni</button>
                        ${hasChronicle ? '<button class="tab-button" data-tab="chronicle">üìú Cronache</button>' : ''}
                        ${hasArtwork ? '<button class="tab-button" data-tab="artwork">üé® Illustrazioni</button>' : ''}
                    </div>
                    ` : ''}
                    
                    <div class="tab-content active" id="info-${kingdom.name}">
                        <h4>Capitale</h4>
                        <p>${kingdom.details.capitale}</p>
                        
                        <h4>Governo</h4>
                        <p>${kingdom.details.governo}</p>
                        
                        <h4>Popolazione</h4>
                        <p>${kingdom.details.popolazione}</p>
                        
                        <h4>Cultura e Societ√†</h4>
                        <ul>
                            ${kingdom.details.cultura.map(item => `<li>${item}</li>`).join('')}
                        </ul>
                        
                        <h4>Economia</h4>
                        <ul>
                            ${kingdom.details.economia.map(item => `<li>${item}</li>`).join('')}
                        </ul>
                        
                        <h4>Pericoli per i Viaggiatori</h4>
                        <ul>
                            ${kingdom.details.pericoli.map(item => `<li>${item}</li>`).join('')}
                        </ul>
                    </div>
                    
                    ${hasChronicle ? `
                    <div class="tab-content" id="chronicle-${kingdom.name}">
                        <div class="chronicles-content">
                            <h4>Cronache del Regno</h4>
                            <div class="chronicles-text">
                                ${formatChronicleText(kingdom.chronicle)}
                            </div>
                        </div>
                    </div>
                    ` : ''}
                    
                    ${hasArtwork ? `
                    <div class="tab-content" id="artwork-${kingdom.name}">
                        <div class="artwork-content">
                            <h4>Vedute del Regno</h4>
                            ${kingdom.artwork ? 
                                `<img src="${kingdom.artwork}" alt="Illustrazione di ${kingdom.name}" loading="lazy" class="artwork-image">` : 
                                `<div class="artwork-placeholder">
                                    <span>Illustrazione in arrivo...</span>
                                </div>`
                            }
                        </div>
                    </div>
                    ` : ''}
                </div>
                
                <p class="expand-indicator">‚Üì Clicca per maggiori dettagli ‚Üì</p>
            `;
            
            // Event listener per aprire/chiudere i dettagli
            card.addEventListener('click', (e) => {
                // Non fare nulla se si clicca su una tab
                if (e.target.closest('.tab-button')) return;
                
                const details = card.querySelector('.kingdom-details');
                const indicator = card.querySelector('.expand-indicator');
                
                if (details.classList.contains('active')) {
                    details.classList.remove('active');
                    indicator.innerHTML = '‚Üì Clicca per maggiori dettagli ‚Üì';
                } else {
                    // Chiudi tutti gli altri
                    document.querySelectorAll('.kingdom-details').forEach(d => {
                        d.classList.remove('active');
                    });
                    document.querySelectorAll('.expand-indicator').forEach(i => {
                        i.innerHTML = '‚Üì Clicca per maggiori dettagli ‚Üì';
                    });
                    
                    details.classList.add('active');
                    indicator.innerHTML = '‚Üë Clicca per chiudere ‚Üë';
                }
            });
            
            // Event listener per le tab
            card.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    e.stopPropagation();
                    
                    const tabName = button.getAttribute('data-tab');
                    const cardContainer = button.closest('.kingdom-card');
                    
                    // Se stiamo cliccando su "Cronache", espandi a schermo intero
                    if (tabName === 'chronicle') {
                        expandChronicleCard(cardContainer);
                    } else if (tabName === 'artwork') {
                        // Se NON siamo in modalit√† espansa, espandi
                        if (!cardContainer.classList.contains('chronicle-expanded')) {
                            expandChronicleCard(cardContainer);
                        }
                        // Se siamo gi√† espansi, lascia che il codice normale gestisca il cambio tab
                    } else if (tabName === 'info') {
                        // Se siamo in modalit√† espansa e clicchiamo su "Informazioni", chiudi
                        if (cardContainer.classList.contains('chronicle-expanded')) {
                            closeChronicleCard(cardContainer);
                            return; // Non continuare con l'attivazione della tab
                        }
                    }
                    
                    // Rimuovi classe active da tutti i button della card
                    cardContainer.querySelectorAll('.tab-button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // Rimuovi classe active da tutti i tab content della card
                    cardContainer.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // Aggiungi classe active al button cliccato
                    button.classList.add('active');
                    
                    // Aggiungi classe active al tab content corrispondente
                    const targetContent = cardContainer.querySelector(`#${tabName}-${kingdom.name}`);
                    if (targetContent) {
                        targetContent.classList.add('active');
                    }
                });
            });
            
            // Event listener per il pulsante di chiusura
            const closeBtn = card.querySelector('.chronicle-close-btn');
            if (closeBtn) {
                closeBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    closeChronicleCard(card);
                });
            }

            // Event listener per zoom delle immagini
            const artworkImage = card.querySelector('.artwork-image');
            if (artworkImage) {
                artworkImage.addEventListener('click', (e) => {
                    e.stopPropagation();
                    artworkImage.classList.toggle('zoomed');
                });
            }
            
            return card;
        }

        // Funzioni per gestire l'espansione delle cronache
        function expandChronicleCard(card) {
            // PULIZIA COMPLETA: Rimuovi tutti gli overlay esistenti prima di procedere
            cleanupAllOverlays();
            
            // Chiudi eventuali altre card espanse
            document.querySelectorAll('.kingdom-card.chronicle-expanded').forEach(expandedCard => {
                if (expandedCard !== card) {
                    closeChronicleCard(expandedCard);
                }
            });
            
            // Verifica che non ci siano gi√† overlay (doppia sicurezza)
            const existingOverlay = document.querySelector('.chronicle-overlay');
            if (existingOverlay) {
                existingOverlay.remove();
            }
            
            // Crea l'overlay
            const overlay = document.createElement('div');
            overlay.className = 'chronicle-overlay';
            overlay.addEventListener('click', () => closeChronicleCard(card));
            document.body.appendChild(overlay);
            
            // Espandi la card
            card.classList.add('chronicle-expanded');
            document.body.classList.add('chronicle-open');
            
            // Assicurati che i dettagli siano aperti
            const details = card.querySelector('.kingdom-details');
            if (!details.classList.contains('active')) {
                details.classList.add('active');
                const indicator = card.querySelector('.expand-indicator');
                if (indicator) {
                    indicator.innerHTML = '‚Üë Clicca per chiudere ‚Üë';
                }
            }
        }

        function closeChronicleCard(card) {
            // PULIZIA COMPLETA: Rimuovi TUTTI gli overlay e ripristina lo stato
            cleanupAllOverlays();
            
            // Chiudi la card (anche se card √® null per sicurezza)
            if (card) {
                card.classList.remove('chronicle-expanded');
                
                // Torna alla tab "Informazioni"
                const infoTab = card.querySelector('[data-tab="info"]');
                const infoContent = card.querySelector('[id^="info-"]');
                
                // Rimuovi active da tutte le tab
                card.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                card.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                // Attiva solo la tab "Informazioni"
                if (infoTab && infoContent) {
                    infoTab.classList.add('active');
                    infoContent.classList.add('active');
                }
            }
            
            // Assicurati che non ci siano card espanse rimaste
            document.querySelectorAll('.kingdom-card.chronicle-expanded').forEach(expandedCard => {
                expandedCard.classList.remove('chronicle-expanded');
            });
        }

        function closeChronicleCardWithAnimation(card) {
            // Aggiungi classe di animazione per il ritorno
            card.style.transition = 'all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
            
            // Prima attiva la tab "Informazioni"
            const infoTab = card.querySelector('[data-tab="info"]');
            const infoContent = card.querySelector('[id^="info-"]');
            
            // Rimuovi active da tutte le tab
            card.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            card.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Attiva la tab "Informazioni"
            if (infoTab && infoContent) {
                infoTab.classList.add('active');
                infoContent.classList.add('active');
            }
            
            // Dopo un piccolo delay, inizia l'animazione di chiusura
            setTimeout(() => {
                closeChronicleCard(card);
                
                // Ripristina la transizione normale dopo l'animazione
                setTimeout(() => {
                    card.style.transition = '';
                }, 400);
            }, 100);
        }

        // Funzione di pulizia globale per risolvere problemi di stato
        function cleanupAllOverlays() {
            // Rimuovi TUTTI gli overlay esistenti (potrebbero essercene pi√π di uno)
            document.querySelectorAll('.chronicle-overlay').forEach(overlay => {
                overlay.remove();
            });
            
            // Ripristina sempre lo stato del body
            document.body.classList.remove('chronicle-open');
            
            // Ripristina lo scroll del body se era bloccato
            document.body.style.overflow = '';
        }

        // Inizializza i regni
        const kingdomsGrid = document.getElementById('kingdomsGrid');
        kingdoms.forEach(kingdom => {
            kingdomsGrid.appendChild(createKingdomCard(kingdom));
        });

        // Scroll to top
        const scrollToTop = document.getElementById('scrollToTop');
        
        window.addEventListener('scroll', () => {
            if (window.pageYOffset > 300) {
                scrollToTop.classList.add('visible');
            } else {
                scrollToTop.classList.remove('visible');
            }
        });
        
        scrollToTop.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Crea particelle fluttuanti
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 25;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (12 + Math.random() * 8) + 's';
                
                // Variazione leggera della dimensione
                const size = 3 + Math.random() * 2;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                
                particlesContainer.appendChild(particle);
            }
        }

        // Inizializza tutto quando la pagina √® caricata
        window.addEventListener('load', () => {
            createParticles();
            
            // Avvia l'animazione delle card dopo un piccolo delay
            setTimeout(() => {
                document.querySelectorAll('.kingdom-card').forEach(card => {
                    card.classList.add('fade-in');
                });
            }, 500);
            
            // Rimuovi la classe di animazione dopo che √® completata per evitare problemi
            setTimeout(() => {
                document.querySelectorAll('.kingdom-card').forEach(card => {
                    card.classList.remove('fade-in');
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                });
            }, 3000);
        });

        // Chiudi le cronache con ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const expandedCard = document.querySelector('.kingdom-card.chronicle-expanded');
                if (expandedCard) {
                    closeChronicleCard(expandedCard);
                } else {
                    // Se non c'√® una card espansa ma c'√® un overlay, pulisci tutto
                    const overlay = document.querySelector('.chronicle-overlay');
                    if (overlay) {
                        cleanupAllOverlays();
                    }
                }
            }
        });

        // Pulizia di emergenza se l'utente cambia tab del browser
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // Se la pagina diventa nascosta, pulisci lo stato
                cleanupAllOverlays();
            }
        });

        // Pulizia di emergenza al caricamento della pagina
        window.addEventListener('load', () => {
            cleanupAllOverlays();
        });

        // Placeholder per caricare la mappa
        // Quando carichi la mappa, sostituisci il contenuto di mapContainer con:
        document.getElementById('mapContainer').innerHTML = '<img src="map.jpeg" alt="Mappa dei Sette Regni">';
    </script>
</body>
</html>